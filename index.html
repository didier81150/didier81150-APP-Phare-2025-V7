// --- Parse amélioré et plus robuste ---
function parseInitialStudents(studentString) {
  const students = [];
  const lines = studentString.split('\n').map(l => l.trim()).filter(l => l && !l.startsWith('//'));

  lines.forEach(line => {
    // supporter tab, espaces multiples, ou virgule comme séparateur
    const parts = line.split(/\s+|,/).map(p => p.trim()).filter(Boolean);
    if (parts.length >= 3) {
      const id = parts[0].toLowerCase();         // normaliser l'ID en minuscule
      const clazz = parts[1];
      const temp = parts[2].trim();             // enlever espaces invisibles
      students.push({
        id: id,
        class: clazz,
        tempPassword: temp,
        password: null
      });
    } else {
      console.warn('Ligne élève ignorée (format incorrect) :', line);
    }
  });

  console.log('parseInitialStudents ->', students);
  return students;
}

// --- Appliquer la config initiale : merge si déjà des élèves (évite écrasement non voulu) ---
function applyInitialConfiguration() {
  // Nom & logo inchangés...
  if (INITIAL_CONFIG.schoolName && INITIAL_CONFIG.schoolName !== "Collège [NOM DE VOTRE ÉTABLISSEMENT]") {
    localStorage.setItem('schoolName', INITIAL_CONFIG.schoolName);
  }
  if (DEFAULT_LOGO_BASE64) {
    localStorage.setItem('schoolLogo', DEFAULT_LOGO_BASE64);
  }

  // Ajouter les élèves initiaux (sans dupliquer)
  const initialStudentsParsed = parseInitialStudents(INITIAL_CONFIG.initialStudents);
  if (initialStudentsParsed.length > 0) {
    // charger liste existante si présente
    const existing = JSON.parse(localStorage.getItem('studentsList') || '[]');
    initialStudentsParsed.forEach(s => {
      const exists = existing.some(e => e.id === s.id && e.class === s.class);
      if (!exists) existing.push(s);
    });
    studentsList = existing;
    localStorage.setItem('studentsList', JSON.stringify(studentsList));
    console.log('applyInitialConfiguration -> studentsList sauvegardé', studentsList);
  } else {
    console.log('applyInitialConfiguration -> aucun élève initial détecté');
  }
}
